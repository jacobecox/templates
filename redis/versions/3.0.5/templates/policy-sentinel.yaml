kind: policy
name: {{ include "redis.sentinelPolicyName" . }}
description: Redis Sentinel Policy
tags: {{- include "redis.tags" . | nindent 4 }}
bindings:
  - permissions:
      - reveal
    principalLinks:
      - //gvc/{{ .Values.global.cpln.gvc }}/identity/{{ include "redis.sentinelIdentityName" . }}
targetKind: secret
targetLinks:
  - //secret/{{ include "redis.sentinelSecretConfigName" . }}
  {{- if and (hasKey .Values.sentinel "auth") (hasKey .Values.sentinel.auth "fromSecret") .Values.sentinel.auth.fromSecret.enabled }}
  - //secret/{{ .Values.sentinel.auth.fromSecret.name }}
  {{- else if and (hasKey .Values.sentinel "auth") (hasKey .Values.sentinel.auth "password") .Values.sentinel.auth.password.enabled }}
  - //secret/{{ include "redis.sentinelSecretPasswordName" . }}
  {{- end }}
  {{- if and (hasKey .Values.redis "auth") (hasKey .Values.redis.auth "fromSecret") .Values.redis.auth.fromSecret.enabled }}
  - //secret/{{ .Values.redis.auth.fromSecret.name }}
  {{- else if and (hasKey .Values.redis "auth") (hasKey .Values.redis.auth "password") .Values.redis.auth.password.enabled }}
  - //secret/{{ include "redis.secretPasswordName" . }}
  {{- end }}