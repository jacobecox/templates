kind: secret
name: {{.Release.Name}}-ingester-conf
description: Manticore ingester configuration
tags: {{- include "manticore.tags" . | nindent 4 }}
type: opaque
data:
  encoding: plain
  payload: |-
    indexer {
      mem_limit = 2G
    }

    index addresses_main
    {
        source     = addresses_main_csv
        path       = /index/addresses_main/addresses_main
        morphology = none
    }

    index addresses_delta
    {
        source     = addresses_delta_csv
        path       = /index/addresses_delta/addresses_delta
        morphology = none
    }

    source addresses_main_csv
    {
        type            = csvpipe
        csvpipe_command = cat /work/addresses_main.ingest.csv

        # Column 1 = implicit docid (address_id)

        csvpipe_attr_uint  = street_number
        csvpipe_field      = street_name
        csvpipe_field      = city
        csvpipe_field      = county
        csvpipe_field      = state
        csvpipe_field      = postal_code
        csvpipe_field      = country
        csvpipe_attr_float = latitude
        csvpipe_attr_float = longitude
    }

    source addresses_delta_csv
    {
        type            = csvpipe
        csvpipe_command = cat /work/addresses_delta.ingest.csv

        # Column 1 = implicit docid (address_id)

        csvpipe_attr_uint  = street_number
        csvpipe_field      = street_name
        csvpipe_field      = city
        csvpipe_field      = county
        csvpipe_field      = state
        csvpipe_field      = postal_code
        csvpipe_field      = country
        csvpipe_attr_float = latitude
        csvpipe_attr_float = longitude
    }
