kind: secret
name: {{ .Release.Name }}-manticore-schema
description: Manticore index schema configuration (user-customizable)
tags: {{- include "manticore.tags" . | nindent 4 }}
type: opaque
data:
  encoding: plain
  payload: |-
    # =============================================================================
    # Manticore Index Schema Configuration
    # =============================================================================
    # This file defines the source and index configuration for plain indices.
    # Users should customize this for their specific data schema.
    #
    # The csvpipe_command reads from the import directory where files are copied
    # from the S3 mount during the import process.
    # =============================================================================

    indexer {
        mem_limit = 2G
    }

    # -----------------------------------------------------------------------------
    # Source Definition
    # -----------------------------------------------------------------------------
    # Defines how to read the CSV data. Customize the fields to match your schema.
    # Available types:
    #   csvpipe_field      - Full-text searchable field
    #   csvpipe_attr_uint  - Unsigned integer attribute
    #   csvpipe_attr_bigint - Big integer attribute
    #   csvpipe_attr_float - Float attribute
    #   csvpipe_attr_string - String attribute (not full-text indexed)
    # -----------------------------------------------------------------------------

    source {{ .Values.buckets.dataset }}_source {
        type            = csvpipe
        csvpipe_command = cat /var/lib/manticore/import/data.csv

        # Example schema for addresses dataset (customize for your data)
        # Column 1 is implicitly used as document ID

        csvpipe_attr_uint  = street_number
        csvpipe_field      = street_name
        csvpipe_field      = city
        csvpipe_field      = county
        csvpipe_field      = state
        csvpipe_field      = postal_code
        csvpipe_field      = country
        csvpipe_attr_float = latitude
        csvpipe_attr_float = longitude
    }

    # -----------------------------------------------------------------------------
    # Index Definition
    # -----------------------------------------------------------------------------
    # Defines the plain index that will be built from the source.
    # Plain indices are read-only and optimized for fast searching.
    # -----------------------------------------------------------------------------

    index {{ .Values.buckets.dataset }}_main {
        source     = {{ .Values.buckets.dataset }}_source
        path       = /var/lib/manticore/main/{{ .Values.buckets.dataset }}_main
        morphology = none
    }
