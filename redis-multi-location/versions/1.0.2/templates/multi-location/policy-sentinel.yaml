{{- if .Values.locations }}
{{- $current := . }}
kind: policy
name: {{ include "redis.sentinelPolicyName" $current }}
description: Sentinel Policy
tags: {{- include "redis.tags" $current | nindent 4 }}
bindings:
  - permissions:
      - reveal
    principalLinks:
      {{ include "calculateWorkloadCounts" $current }}
      {{- $locationCount := $current.Values.global.locationCount }}
      {{- range $l := until $locationCount }}
      {{ $locationName := index $current.Values.locations $l }}
      - //gvc/{{ $current.Release.Name }}-{{ $locationName }}/identity/{{ include "redis.sentinelIdentityName" $current }}
      {{- end }}      
targetKind: secret
targetLinks:
  - //secret/{{ include "redis.sentinelSecretConfigName" $current }}
{{- else }}
{{- end }}